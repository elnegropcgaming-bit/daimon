name: gate

on:
  issues:
    types: [opened]

jobs:
  label:
    runs-on: ubuntu-latest
    steps:
      - name: label issues by source
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          ISSUE_AUTHOR: ${{ github.event.issue.user.login }}
          ISSUE_NUMBER: ${{ github.event.issue.number }}
          ISSUE_TITLE: ${{ github.event.issue.title }}
        run: |
          REPO_OWNER=$(echo "${{ github.repository }}" | cut -d'/' -f1)
          if [ "$ISSUE_AUTHOR" = "$REPO_OWNER" ]; then
            if echo "$ISSUE_TITLE" | grep -qi '^\[directive\]'; then
              gh issue edit "$ISSUE_NUMBER" --repo "${{ github.repository }}" --add-label "directive"
            else
              gh issue edit "$ISSUE_NUMBER" --repo "${{ github.repository }}" --add-label "self"
            fi
          else
            gh issue edit "$ISSUE_NUMBER" --repo "${{ github.repository }}" --add-label "visitor"
          fi
